{
  "project": "AI Candidate Filtering System",
  "branchName": "ralph/ai-filtering",
  "description": "Intelligent filtering system that processes candidate lists and categorizes them into Proceed/Human Review/Dismiss/Unable to Enrich buckets using AI evaluation with LinkedIn enrichment",
  "userStories": [
    {
      "id": "US-000A",
      "title": "Database Schema Design and Implementation",
      "description": "As a developer, I need a complete database schema to support the AI filtering system so that all subsequent user stories can store and retrieve data correctly.",
      "acceptanceCriteria": [
        "All 7 tables created: roles, criteria_versions, filter_runs, filter_results, enriched_candidates, uploaded_files, test_runs",
        "All foreign key relationships defined",
        "CHECK constraints added for enum fields (status, run_type, final_determination, file_type)",
        "Indexes created on all foreign keys and frequently queried columns",
        "JSON structure documented for criteria_data, criteria_evaluations, job_history, education, skills",
        "Schema creation script runs without errors",
        "Foreign key constraints enforced (orphaned records prevented)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-001A",
      "title": "Role/Project CRUD Backend",
      "description": "As a developer, I need backend API endpoints for role management so users can create and manage filtering projects.",
      "acceptanceCriteria": [
        "API endpoint: POST /api/roles (create new role)",
        "API endpoint: GET /api/roles (list all roles)",
        "API endpoint: GET /api/roles/:id (get single role)",
        "API endpoint: PUT /api/roles/:id (update role metadata)",
        "API endpoint: DELETE /api/roles/:id (soft delete - set status='archived')",
        "Roles use UUID primary keys",
        "Created and updated timestamps auto-populated",
        "Returns proper HTTP status codes (200, 201, 404, 400)",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-001B",
      "title": "Role Management UI",
      "description": "As a recruiter, I want a web interface to manage roles/projects so I can organize filtering work by position.",
      "acceptanceCriteria": [
        "Roles list page displays all active roles",
        "Create new role button opens modal with name and description fields",
        "Role cards show name, description, created date, and action buttons",
        "Edit button opens modal to update role metadata",
        "Archive button soft-deletes role (sets status='archived')",
        "Archived roles hidden from main list (optional filter to show them)",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-001C",
      "title": "Document Upload Backend",
      "description": "As a developer, I need backend file upload endpoints so recruiters can provide job descriptions and calibration data.",
      "acceptanceCriteria": [
        "API endpoint: POST /api/roles/:id/files (upload file)",
        "Accepts file types: jd, intake, calibration",
        "Saves files to storage directory (e.g., /uploads/roles/:role_id/)",
        "Stores file metadata in uploaded_files table (role_id, file_type, filename, file_path, file_size)",
        "Returns file metadata JSON on successful upload",
        "Validates file type (only accept .pdf, .docx, .txt, .md)",
        "API endpoint: DELETE /api/files/:id (delete uploaded file)",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-001D",
      "title": "Document Upload UI",
      "description": "As a recruiter, I want to upload job descriptions and related documents so the AI can extract filtering criteria.",
      "acceptanceCriteria": [
        "Role detail page has file upload section with 3 dropzones: JD, Intake Form, Calibration Candidates",
        "Drag-and-drop file upload works for each dropzone",
        "Shows uploaded file name, size, and upload date",
        "Delete button removes uploaded file",
        "Can replace file by uploading new one to same dropzone",
        "Shows upload progress indicator",
        "Error messages for invalid file types or upload failures",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-001E",
      "title": "AI Criteria Extraction",
      "description": "As a recruiter, I want AI to analyze uploaded documents and suggest filtering criteria so I don't have to manually configure everything.",
      "acceptanceCriteria": [
        "Backend reads uploaded JD, intake form, and calibration candidate files",
        "Sends file contents to Claude API with extraction prompt",
        "Claude extracts must-haves, gating parameters, and nice-to-haves from documents",
        "Parses Claude response into structured JSON (must_haves array, gating_parameters array, nice_to_haves array)",
        "Stores extracted criteria temporarily (not saved to criteria_versions yet)",
        "Returns extracted criteria JSON to frontend",
        "Handles extraction failures gracefully (empty arrays if no criteria found)",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-001F",
      "title": "Criteria Configuration Form UI",
      "description": "As a recruiter, I want to review and edit AI-suggested criteria so I can customize filtering rules for each role.",
      "acceptanceCriteria": [
        "Criteria configuration page displays 3 sections: Must-Haves, Gating Parameters, Nice-to-Haves",
        "Must-Haves section shows AI-extracted requirements as editable text fields",
        "User can add/remove must-have items",
        "Gating Parameters section shows checkboxes for common rules (job hopper, bootcamp-only, work auth, location) plus custom text input",
        "Nice-to-Haves section shows AI-extracted preferences as editable text fields",
        "User can add/remove nice-to-have items",
        "Save button stores criteria to criteria_versions table with version number",
        "Form validation ensures at least one must-have is defined",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005A",
      "title": "LinkedIn Profile Fetching",
      "description": "As a system, I need to fetch LinkedIn profile data using Claude browser tool so I can enrich candidate information for evaluation.",
      "acceptanceCriteria": [
        "Function accepts LinkedIn URL as input",
        "Uses Claude browser tool to visit LinkedIn profile page",
        "Extracts raw HTML or structured profile data",
        "Handles errors: profile not found (404), rate limits, private profile (login required)",
        "Returns raw profile data or error status",
        "Stores raw data in enriched_candidates table with fetched_at timestamp",
        "Does NOT attempt to parse/extract fields (that's US-005B)",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005B",
      "title": "LinkedIn Data Extraction",
      "description": "As a system, I need to parse LinkedIn profile data into structured fields so it can be used for criteria evaluation.",
      "acceptanceCriteria": [
        "Function accepts raw LinkedIn profile data from US-005A",
        "Extracts current_title and current_company",
        "Extracts job_history array with title, company, start_date, end_date, duration_months",
        "Extracts education array with school, degree, field, graduation_year",
        "Extracts skills array (list of skill names)",
        "Extracts location string",
        "Normalizes data into consistent JSON format",
        "Updates enriched_candidates table with extracted fields",
        "Handles missing fields gracefully (null or empty array)",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005C",
      "title": "Enrichment Caching",
      "description": "As a system, I need to cache enriched LinkedIn data to avoid redundant fetches and respect rate limits.",
      "acceptanceCriteria": [
        "Before fetching LinkedIn profile, check enriched_candidates table by linkedin_url",
        "If cached data exists and fetched_at < 30 days ago, return cached data",
        "If cached data is stale (>30 days) or missing, fetch fresh data",
        "Cache lookup uses index on linkedin_url for fast queries",
        "Cache expiry computed as: datetime('now') <= datetime(fetched_at, '+30 days')",
        "Function returns {data, source: 'cache'|'fresh'} to indicate cache hit/miss",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002A",
      "title": "Random Candidate Selection",
      "description": "As a recruiter, I want to test criteria on a random sample of 50 candidates so I can validate filtering logic before running on the full list.",
      "acceptanceCriteria": [
        "User uploads CSV for test run",
        "System randomly selects 50 candidates from CSV (or all if CSV has <50)",
        "Selected candidate identifiers (emails or unique IDs) stored in test_runs table",
        "test_run_id created and linked to role_id and criteria_version_id",
        "Returns selected candidates array to frontend",
        "Subsequent test runs with same criteria_version reuse same 50 candidates (unless user explicitly resets)",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002B",
      "title": "Test Run Processing",
      "description": "As a system, I need to run filtering on test candidates with LinkedIn enrichment and criteria evaluation.",
      "acceptanceCriteria": [
        "For each test candidate, attempt LinkedIn enrichment (US-005A, US-005B, US-005C)",
        "If enrichment fails and CSV data insufficient, mark as 'Unable to Enrich'",
        "Evaluate each criteria (must-haves, gating params, nice-to-haves) using enriched data",
        "For each criteria, determine Pass/Fail/Unsure with one-sentence reasoning",
        "Apply final determination logic: Proceed/Human Review/Dismiss/Unable to Enrich per FR-3",
        "Store test results in filter_results table linked to test run_id",
        "Update filter_runs with counts (proceed_count, review_count, dismiss_count, unable_to_enrich_count)",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002C",
      "title": "Test Results UI",
      "description": "As a recruiter, I want to see test results with reasoning so I can validate criteria accuracy and refine if needed.",
      "acceptanceCriteria": [
        "Test results page displays table with candidates in rows, criteria in columns",
        "Each cell shows Pass (green), Fail (red), or Unsure (yellow) with hover tooltip for reasoning",
        "Final determination column shows Proceed/Human Review/Dismiss/Unable to Enrich",
        "Can filter by final determination (show only Proceed, only Dismiss, etc.)",
        "Can sort by candidate name or final determination",
        "Export to CSV button downloads test results with all criteria evaluations",
        "Refine Criteria button returns to US-001F form (preserves current test set)",
        "Approve & Run button proceeds to US-003 (full/subset run options)",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Approve and Run Full or Subset Filtering",
      "description": "As a recruiter, I want to run approved criteria on the full list or a custom subset so I can scale filtering after validation.",
      "acceptanceCriteria": [
        "After test approval, show run options page",
        "Option 1: Run on full list (radio button, shows total candidate count from CSV)",
        "Option 2: Run on custom subset (radio button + number input for candidate count)",
        "Start Run button triggers batch processing",
        "Progress indicator shows current_candidate / total_candidates",
        "Backend creates filter_run record with status='running'",
        "Processes candidates using same logic as US-002B (enrichment + evaluation)",
        "Updates filter_run counts (proceed_count, review_count, dismiss_count, unable_to_enrich_count) incrementally",
        "Sets status='completed' when done, sets completed_at timestamp",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004A",
      "title": "Results Data Model & API",
      "description": "As a developer, I need API endpoints to fetch filter results so the UI can display them with filtering and sorting.",
      "acceptanceCriteria": [
        "API endpoint: GET /api/runs/:run_id/results",
        "Supports query param: filter=Proceed|Human Review|Dismiss|Unable to Enrich",
        "Supports query param: sort=name|determination|date (default: date desc)",
        "Supports pagination: offset and limit query params",
        "Returns JSON array of candidates with all fields: name, email, linkedin, criteria_evaluations, final_determination",
        "Returns total count for pagination",
        "Uses indexes for fast queries even with 1000+ candidates",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004B",
      "title": "Results Display UI",
      "description": "As a recruiter, I want to see filtered results with reasoning so I know which candidates to contact and why.",
      "acceptanceCriteria": [
        "Results page displays table with candidates: name, email, LinkedIn link, final determination",
        "Expand row shows detailed criteria evaluations (Pass/Fail/Unsure per criteria with reasoning)",
        "Filter buttons at top: All, Proceed, Human Review, Dismiss, Unable to Enrich",
        "Clicking filter button shows only candidates in that bucket",
        "Column headers are sortable (click to sort by name, determination, date)",
        "Pagination controls (prev/next, page numbers) if >100 results",
        "Shows counts: X Proceed, Y Human Review, Z Dismiss, W Unable to Enrich",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004C",
      "title": "Results Export",
      "description": "As a recruiter, I want to export results to CSV so I can share them with my team or import into other systems.",
      "acceptanceCriteria": [
        "Export to CSV button on results page",
        "CSV includes all candidate data: name, email, linkedin_url",
        "CSV includes all criteria evaluations as separate columns (e.g., MustHave1_Result, MustHave1_Reason)",
        "CSV includes final_determination column",
        "CSV includes metadata: run_date, criteria_version, role_name",
        "CSV respects current filter (if user filtered to Proceed only, export only shows Proceed)",
        "Download triggers with proper filename: results_[role-name]_[date].csv",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 17,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Refine Criteria for Existing Role",
      "description": "As a recruiter, I want to refine criteria after seeing results so I can improve accuracy over time.",
      "acceptanceCriteria": [
        "Role detail page has Edit Criteria button",
        "Button loads criteria configuration form (US-001F) with current criteria pre-populated",
        "User can modify must-haves, gating parameters, nice-to-haves",
        "Save creates new criteria_version with incremented version number",
        "Previous criteria_version retained (not deleted)",
        "Can re-run test validation with updated criteria on same test set or new random 50",
        "Run history shows which criteria version was used for each run",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 18,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "View Run History for Role",
      "description": "As a recruiter, I want to see the history of filtering runs so I can track what's been processed and with which criteria.",
      "acceptanceCriteria": [
        "Role detail page has Run History section",
        "Lists all filter_runs for this role in reverse chronological order",
        "Each run shows: date, run_type (test/full/subset), criteria version, total candidates processed",
        "Each run shows result breakdown: X Proceed, Y Human Review, Z Dismiss, W Unable to Enrich",
        "Click on run opens results page (US-004B) for that specific run",
        "Can export results from any historical run (not just latest)",
        "Shows run status (running, completed, failed)",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    }
  ]
}
