# Ralph Progress Log
Started: Mon Jan 26 07:24:00 UTC 2026
---
## Codebase Patterns
- Database schema lives in `database/schema.sql` and is applied via `python3 database/migrate.py --sql <file>`.
- Batch uploads are stored under `uploads/batches/{batch_id}` with metadata saved via `webapp.db.create_candidate_batch` and `webapp.db.insert_batch_file_upload`.
## 2026-01-26 07:26:53 UTC - US-001
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Added candidate batch tables and indexes to the SQLite schema and added a migration script to apply schema SQL.
- Files changed: `database/schema.sql`, `database/migrate.py`, `scripts/ralph/prd.json`, `scripts/ralph/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered (e.g., "this codebase uses X for Y")
    - Schema updates are applied to `data.db` with `python3 database/migrate.py --sql database/schema.sql`.
  - Gotchas encountered (e.g., "don't forget to update Z when changing W")
    - None.
  - Useful context (e.g., "the evaluation panel is in component X")
    - Candidate batch tables live alongside core AI filtering tables in `database/schema.sql`.
---
## 2026-01-26 07:30:51 UTC - US-002
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Added multi-CSV batch upload API, saving files under uploads/batches/{batch_id}, capturing headers/row counts, and persisting batch/file metadata in data.db.
- Files changed: `webapp/main.py`, `webapp/db.py`, `AGENTS.md`, `scripts/ralph/prd.json`, `scripts/ralph/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered (e.g., "this codebase uses X for Y")
    - Batch uploads use `uploads/batches/{batch_id}` with metadata stored via `webapp.db.create_candidate_batch` and `webapp.db.insert_batch_file_upload`.
  - Gotchas encountered (e.g., "don't forget to update Z when changing W")
    - None.
  - Useful context (e.g., "the evaluation panel is in component X")
    - Upload endpoint validates CSV extensions and stores parsed headers in `batch_file_uploads.headers`.
---
## 2026-01-26 07:33:15 UTC - US-003A
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Added suggest-mappings API that reads batch upload headers, calls Claude for field mapping suggestions, and returns per-file mappings.
- Files changed: `webapp/main.py`, `webapp/db.py`, `scripts/ralph/prd.json`, `scripts/ralph/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered (e.g., "this codebase uses X for Y")
    - None.
  - Gotchas encountered (e.g., "don't forget to update Z when changing W")
    - None.
  - Useful context (e.g., "the evaluation panel is in component X")
    - Suggest-mappings uses `batch_file_uploads.headers` and calls Claude per file.
---
## 2026-01-26 07:36:29 UTC - US-003B
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Added mapping page route, template, styles, and client-side logic to load AI suggestions, prefill mappings, validate linkedin_url, and submit mappings.
- Files changed: `webapp/main.py`, `webapp/templates/map.html`, `webapp/static/map.css`, `webapp/static/map.js`, `scripts/ralph/prd.json`, `scripts/ralph/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered (e.g., "this codebase uses X for Y")
    - None.
  - Gotchas encountered (e.g., "don't forget to update Z when changing W")
    - None.
  - Useful context (e.g., "the evaluation panel is in component X")
    - Mapping UI fetches suggestions from `/api/batches/:batch_id/suggest-mappings` and posts selections to `/api/batches/:batch_id/apply-mappings`.
---
## 2026-01-26 07:39:29 UTC - US-004
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Added apply-mappings API to read batch CSVs, apply user mappings, split full_name when needed, deduplicate by linkedin_url, insert raw_candidates, and update batch status.
- Files changed: `webapp/main.py`, `webapp/db.py`, `scripts/ralph/prd.json`, `scripts/ralph/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered (e.g., "this codebase uses X for Y")
    - None.
  - Gotchas encountered (e.g., "don't forget to update Z when changing W")
    - None.
  - Useful context (e.g., "the evaluation panel is in component X")
    - Apply-mappings reads CSVs from `uploads/batches/{batch_id}` and persists rows in `raw_candidates`.
---
